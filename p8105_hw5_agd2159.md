P8015_Hw5_agd2159
================
Zander De Jesus
11-15-2023

``` r
library(tidyverse)
set.seed(1234)

theme_set(theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1: Washington Post Homicide Data Exploration

``` r
wp_homicides = read_csv("homicide-data/homicide-data.csv", na = c("", "NA", "Unknown")) |> 
  mutate(city_state = str_c(city, state, sep = ","),
    resolution = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved")) |> 
  filter(city_state != "Tulsa,AL")
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (8): uid, victim_last, victim_first, victim_race, victim_sex, city, stat...
    ## dbl (4): reported_date, victim_age, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Before more transformative cleaning, this dataframe has 52178 entries,
on variables that include the victim name, race, age, and sex; the date
the homicide was reported; and the location of the homicide. Using the
mutate and case_when functions, we add a city_state variable that
combines the string data from both city and state, and a resolution
column variable that indicates the present status of a homicide case.
Filtering out Tulsa, AL which was accidentally included alongside Tulsa,
OK.

``` r
totals_homicide_df = 
  wp_homicides |> 
  select(city_state, disposition, resolution) |>  
  group_by(city_state) |> 
  summarize(
    homicides_total = n(),
    homicides_unsolved = sum(resolution == "unsolved"))
```

Starting to use `prop.test` to see the proportional significance of
unresolved homicides in particular cities.

``` r
bmore_test = 
  prop.test(
    x = filter(totals_homicide_df, city_state == "Baltimore,MD") |> pull(homicides_unsolved),
    n = filter(totals_homicide_df, city_state == "Baltimore,MD") |>  pull(homicides_total)) 

broom::tidy(bmore_test) |> 
  knitr::kable(digits = 3)
```

| estimate | statistic | p.value | parameter | conf.low | conf.high | method                                               | alternative |
|---------:|----------:|--------:|----------:|---------:|----------:|:-----------------------------------------------------|:------------|
|    0.646 |   239.011 |       0 |         1 |    0.628 |     0.663 | 1-sample proportions test with continuity correction | two.sided   |

Now that we have this function established, important to standardize
across cities. Map package can place this test across all cells within
the tibble.

``` r
test_results = 
  totals_homicide_df |> 
  mutate(
    prop_tests = map2(homicides_unsolved, homicides_total, \(x, y) prop.test(x = x, n = y)),
    tidy_tests = map(prop_tests, broom::tidy)) |>  
  select(-prop_tests) |> 
  unnest(tidy_tests) |> 
  select(city_state, estimate, conf.low, conf.high) |>  
  mutate(city_state = fct_reorder(city_state, estimate))
```

We then visualize the unsolved case proportion across cities using
ggplot scatterpoint tools.

``` r
test_results |>  
  mutate(city_state = fct_reorder(city_state, estimate)) |>  
  ggplot(aes(x = city_state, y = estimate)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

![](p8105_hw5_agd2159_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

The percentage of unsolved homicides ranges across cities from about 25%
on the low end to over 60%-70% on the highest end. **Chicago, IL, New
Orleans, LA, and Baltimore, MD** are the top three cities for the
highest proportion of unresolved homicides.

# Problem 2: Compiling Randomized Control Trial Dataframe using MAP Function

# Problem 3: Simulation of One-Sided T-Test
